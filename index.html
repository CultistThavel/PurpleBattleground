<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Purple Battleground ULTIMATE EDITION</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #3d4147; 
            font-family: 'Arial Black', sans-serif; user-select: none; 
            touch-action: manipulation;
        }

        #game-view { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
        #floor { position: absolute; bottom: 0; width: 100%; height: 40%; background: #60646b; border-top: 12px solid #000; z-index: 10; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° –ì–õ–ê–í–ù–´–ô */
        .ui-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; transition: opacity 0.6s ease; }
        .ui-element { pointer-events: auto; }

        #top-header { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 80%; display: flex; flex-direction: column; align-items: center; }
        #game-title { background: #fff; border: 8px solid #000; border-radius: 20px; font-size: 38px; width: 100%; text-align: center; box-shadow: 0 8px 0 #000; margin-bottom: 10px; }
        
        #player-hp-bar { width: 90%; height: 45px; background: #550000; border: 6px solid #000; border-radius: 15px; position: relative; overflow: hidden; }
        #player-hp-fill { position: absolute; left: 0; top: 0; height: 100%; width: 100%; background: #ccff00; transition: width 0.3s ease-out; }
        #player-hp-bg { position: absolute; left: 0; top: 0; height: 100%; width: 100%; background: #ff0000; z-index: -1; }
        #player-hp-text { position: absolute; width: 100%; text-align: center; color: #fff; font-size: 24px; line-height: 45px; text-shadow: 2px 2px 0 #000; z-index: 2; }

        /* –ú–ê–ì–ê–ó–ò–ù –ò –î–ï–ù–¨–ì–ò */
        #money-box { position: absolute; top: 160px; left: 30px; color: #fff; font-size: 40px; text-shadow: 3px 3px 0 #000; }
        #shop-trigger { position: absolute; top: 230px; left: 30px; width: 140px; height: 140px; background: #fff; border: 8px solid #000; border-radius: 30px; font-size: 80px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 8px 8px 0 #000; }

        /* –í–û–õ–ù–´ */
        #wave-info { position: absolute; top: 160px; right: 30px; text-align: right; color: #fff; }
        #wave-num { font-size: 70px; margin: 0; -webkit-text-stroke: 2px #000; }
        #enemies-left { font-size: 25px; }

        /* –ë–û–°–° –®–ö–ê–õ–ê */
        #global-boss-ui { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); width: 85%; display: none; flex-direction: column; align-items: center; z-index: 2000; opacity: 0; transition: opacity 0.8s; }
        #boss-bar-frame { width: 100%; height: 60px; background: #000; border: 5px solid #fff; border-radius: 10px; position: relative; }
        #boss-bar-fill { height: 100%; background: #00ff00; width: 100%; transition: width 0.2s; }
        #boss-bar-text { position: absolute; top: 0; width: 100%; text-align: center; color: #fff; font-size: 30px; line-height: 60px; }
        #boss-label { color: #fff; font-size: 32px; margin-top: 5px; -webkit-text-stroke: 1px #a020f0; font-weight: 900; }

        /* –ü–ï–†–°–û–ù–ê–ñ–ò */
        #hero { position: absolute; bottom: 25%; left: 80px; width: 450px; z-index: 50; transition: transform 0.2s; }
        #heli-support { position: absolute; bottom: 15%; left: 220px; width: 280px; z-index: 60; display: none; }
        
        .enemy-unit { position: absolute; bottom: 25%; right: -500px; width: 400px; z-index: 45; display: flex; flex-direction: column; align-items: center; transition: filter 0.3s; }
        .enemy-info { color: #fff; font-size: 22px; -webkit-text-stroke: 1px #000; margin-bottom: 5px; }
        .enemy-hp-wrap { width: 80%; height: 20px; background: #000; border: 3px solid #fff; }
        .enemy-hp-bar { height: 100%; background: #0f0; width: 100%; }

        /* –ê–î–ú–ò–ù–ö–ê */
        #admin-panel { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; background: rgba(0,0,0,0.95); border: 6px solid #00ff00; border-radius: 25px; z-index: 10000; display: none; padding: 25px; }
        .adm-btn { width: 100%; padding: 15px; margin: 8px 0; background: #1a1a1a; border: 3px solid #00ff00; color: #fff; font-weight: 900; cursor: pointer; border-radius: 10px; }

        /* –°–ü–ï–¶–≠–§–§–ï–ö–¢–´ */
        #overlay-fx { position: fixed; inset: 0; pointer-events: none; z-index: 5; transition: background 0.5s, filter 0.5s; }
        #flash-bang { position: fixed; inset: 0; background: #fff; opacity: 0; z-index: 50000; display: none; transition: opacity 0.4s; }
        #hint-text { position: fixed; top: 130px; left: 50%; transform: translateX(-50%); color: #fff; font-size: 28px; -webkit-text-stroke: 1px #000; z-index: 3000; display: none; }
        .bullet { position: absolute; width: 120px; z-index: 48; pointer-events: none; }
        .clone-projectile { position: fixed; width: 100px; z-index: 500; transition: all 0.8s cubic-bezier(0.6, -0.28, 0.735, 0.045); }

        /* –°–£–ë–¢–ò–¢–†–´ */
        #sub-container { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%) translateY(400px); width: 85%; background: #fff; border: 10px solid #000; border-radius: 20px; padding: 30px; z-index: 15000; transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #sub-container.visible { transform: translateX(-50%) translateY(0); }
        #sub-author { position: absolute; top: -40px; left: 30px; background: #000; color: #fff; padding: 5px 25px; font-size: 24px; }
        #sub-content { font-size: 34px; color: #000; font-weight: 900; text-align: center; }

        /* –≠–ö–†–ê–ù–´ */
        #death-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 20000; display: none; flex-direction: column; justify-content: center; align-items: center; }
        #ending-screen { position: fixed; inset: 0; background: #fff; z-index: 30000; display: none; flex-direction: column; justify-content: center; align-items: center; }

        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes floatBoss { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-40px); } }
        @keyframes shakeObject { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(2px, -2px); } }
        @keyframes startBtnPulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        #start-battle-btn { position: absolute; bottom: 200px; right: 50px; background: #ccff00; padding: 30px 60px; border: 8px solid #fff; border-radius: 40px; font-size: 40px; cursor: pointer; box-shadow: 0 10px 0 #7a9c00; animation: startBtnPulse 2s infinite; }
    </style>
</head>
<body onclick="handleGlobalClick(event)">

<div id="game-view">
    <div id="overlay-fx"></div>
    <div id="flash-bang"></div>
    
    <div id="global-boss-ui">
        <div id="boss-bar-frame"><div id="boss-bar-fill"></div><div id="boss-bar-text">0/0</div></div>
        <div id="boss-label">BOSS NAME</div>
    </div>

    <div class="ui-wrapper" id="main-ui">
        <div id="top-header">
            <div id="game-title">Purple Battleground</div>
            <div id="player-hp-bar">
                <div id="player-hp-bg"></div>
                <div id="player-hp-fill"></div>
                <div id="player-hp-text">–í–∞—à–∞ –®–∫–∞–ª–∞ –•–ü: 350</div>
            </div>
        </div>

        <div id="money-box">ü™ô Purple Money: <span id="m-count">0</span></div>
        <div id="shop-trigger" class="ui-element" onmousedown="adminHoldStart()" onmouseup="adminHoldEnd()" onclick="event.stopPropagation(); openShop()">üõçÔ∏è</div>

        <div id="wave-info">
            <h1 id="wave-num">1 –í–æ–ª–Ω–∞</h1>
            <div id="enemies-left">–û—Å—Ç–∞–ª–æ—Å—å –í—Ä–∞–≥–æ–≤: 10</div>
        </div>

        <div id="start-battle-btn" class="ui-element" onclick="event.stopPropagation(); initiateWave()">–ù–∞—á–∞—Ç—å –ü–µ—Ä–µ—Å—Ç—Ä–µ–ª–∫—É</div>
    </div>

    <div id="hint-text">–ö–∞–∫ –î–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å: –¢–∞–ø–∞–π—Ç–µ –ø–æ —ç–∫—Ä–∞–Ω—É –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ, —á—Ç–æ–±—ã –æ–¥–æ–ª–µ—Ç—å –≤—Ä–∞–≥–æ–≤.</div>

    <img id="hero" src="https://www.dropbox.com/scl/fi/wkk444qzu4xrvq19yhppg/Picsart_26-02-25_16-18-04-032.png?rlkey=7ktujsblwl5rncjhtzwidmw1u&st=w2isyslh&dl=1">
    <img id="heli-support" src="https://www.dropbox.com/scl/fi/12vlohfl9xc1gsyc834ud/Picsart_26-02-25_20-07-48-108.png?rlkey=ufof2v3c18mp9s0ym3tqlm1sg&st=pyzps94y&dl=1">
    
    <div id="floor"></div>
</div>

<div id="sub-container">
    <div id="sub-author">–ü—É—Ä–ø—É–ª–µ–∑–∫–∞</div>
    <div id="sub-content"></div>
</div>

<div id="admin-panel">
    <h2 style="color:#0f0; text-align:center;">ADMIN MENU</h2>
    <button class="adm-btn" onclick="adminAddCash()">–î–µ–Ω—å–∂–∞—Ç–∞ +100–ö</button>
    <button class="adm-btn" onclick="adminToggleGod()">–ü—Ä–æ–∫–ª—è—Ç–∏–µ (–ë–µ—Å—Å–º–µ—Ä—Ç–∏–µ)</button>
    <button class="adm-btn" onclick="adminToggleAuto()">–ê–≤—Ç–æ –ö–ª–∏–∫–µ—Ä: OFF</button>
    <button class="adm-btn" onclick="adminActivateSorcerer()">Sorcerer</button>
    <button class="adm-btn" onclick="adminSkip()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –í–æ–ª–Ω—É</button>
    <button class="adm-btn" style="border-color:red" onclick="document.getElementById('admin-panel').style.display='none'">–ó–ê–ö–†–´–¢–¨</button>
</div>

<div id="death-screen">
    <h1 style="color:#fff; font-size:60px;">–ú–¥–∞, –ª—É—á—à–µ –±—ã –ø–æ—Å—Ç–∞—Ä–∞–ª—Å—è.</h1>
    <button style="padding: 20px 80px; font-size: 30px; cursor:pointer;" onclick="restartLevel()">–õ–∞–Ω.</button>
</div>

<div id="ending-screen"></div>

<script>
    /* --- CONFIG & DATA --- */
    const CONFIG = {
        PLAYER_MAX_HP: 350,
        BASE_DMG: 50,
        PURP_MAX_HP: 150000,
        RELOAD_INTERVAL: 16
    };

    const ENEMY_TYPES = [
        {id: 1, name: "–ó–æ–º–±–∏ –ó–∞—è—Ü", hp: 55, dmg: 20, time: 6, waves: [1, 5], img: "https://www.dropbox.com/scl/fi/1lsjdbdu0i9ubx2br0a07/Picsart_26-02-25_19-08-39-629.png?rlkey=7guurshr8yh3dd4e2ljmggjlj&st=7ar2q0by&dl=1"},
        {id: 2, name: "–†–∞–±—ã –ü—É—Ä–ø—É–ª–µ–∑–∫–∏", hp: 310, dmg: 55, time: 5, waves: [5, 11], img: "https://www.dropbox.com/scl/fi/tdixfa0a15c8yi5sdefha/Picsart_26-02-25_19-08-49-861.png?rlkey=ylf9ebkaga4iyoshw4g3ca2uk&st=y760bfnq&dl=1"},
        {id: 3, name: "–ú–∞–ª–∏–Ω–æ–≤—ã–π –•—ã—Ä", hp: 780, dmg: 89, time: 4, waves: [11, 20], img: "https://www.dropbox.com/scl/fi/z3omefpvjio3aj6f4cgss/Picsart_26-02-25_19-08-59-599.png?rlkey=u62acjeoulrd9ykrnn64rc4e7&st=q5nh7n82&dl=1"},
        {id: 4, name: "–ö—Ä–æ–≤–∞–≤—ã–π –ë–∞–Ω—Ç–∏–∫", hp: 1989, dmg: 166, time: 4, waves: [20, 28], img: "https://www.dropbox.com/scl/fi/sa88ntns8llt94yyipjho/Picsart_26-02-25_19-09-24-975.png?rlkey=ldstq44p4sdy1n03jlbyfx4qx&st=bfrp08sz&dl=1"},
        {id: 5, name: "–ò—Å—Ç–∏–Ω–Ω—ã–π –ì–æ—Å—Ç—å", hp: 3100, dmg: 250, time: 5, waves: [28, 36], img: "https://www.dropbox.com/scl/fi/cumlg6kmbyntnz8z83699/Picsart_26-02-25_19-09-38-084.png?rlkey=48xnkn11fe5w29uvvy1sl6l09&st=l7wlaih1&dl=1"},
        {id: 6, name: "–©–µ–Ω–æ—Ä–∏—á–Ω—ã–π –°–¥–µ–ª", hp: 7681, dmg: 489, time: 4, waves: [36, 45], img: "https://www.dropbox.com/scl/fi/c76zhvy901pqj6wnhc6ss/Picsart_26-02-25_19-09-48-052.png?rlkey=8erkxojcqgom1in01kzqmh2q6&st=50gpbwdu&dl=1"},
        {id: 7, name: "Shadow Hare", hp: 16772, dmg: 91919191, time: 8, waves: [45, 50], img: "https://www.dropbox.com/scl/fi/dg27h6rb2330uyntn2ga5/Picsart_26-02-25_19-10-23-990.png?rlkey=5x10l6ki04hvfld6krujy21vl&st=0kpxz4z9&dl=1"},
        {id: 8, name: "The Nameless Hare", hp: 35000, dmg: 9999, time: 16, waves: [50, 51], boss: true, img: "https://www.dropbox.com/scl/fi/zdwojmpsz3mf2ie4f1jwj/Picsart_26-02-25_19-10-33-922.png?rlkey=e4l9uktjlvtl7h4du0v7gmluc&st=e4j4mi1c&dl=1"},
        {id: 9, name: "Zombie Father Hare", hp: 21781, dmg: 1891, time: 7, waves: [51, 60], img: "https://www.dropbox.com/scl/fi/rscd5vy3hjxfb2gxlxskb/Picsart_26-02-25_19-10-10-083.png?rlkey=xz01b2w8wl6q3aqqwd7azim6s&st=kvkv0apr&dl=1"},
        {id: 10, name: "–ò–Ω—à–∏", hp: 26789, dmg: 9199, time: 6, waves: [60, 70], img: "https://www.dropbox.com/scl/fi/ivx4llojwlbso1zn571sd/Picsart_26-02-25_19-12-22-085.png?rlkey=lzpcyrefycb4jy6utlyi6snh2&st=gly90j2p&dl=1"},
        {id: 11, name: "Agetha Hare", hp: 56778, dmg: 99999999, time: 21, waves: [70, 71], boss: true, img: "https://www.dropbox.com/scl/fi/982f5rb5tg1qg4st58kj1/Picsart_26-02-25_19-10-51-597.png?rlkey=6l5f4zshwf3ctc4r1z5q4jrcb&st=o2a6yf2f&dl=1"},
        {id: 12, name: "–ü—É—Ä–ø—É–ª–µ–∑–∫–∞", hp: 150000, dmg: 10, time: 0, waves: [71, 72], final: true, img: "https://www.dropbox.com/scl/fi/948wqdc7vn67eimy9itur/Picsart_26-02-25_18-08-27-446.png?rlkey=du6vdlmfisfoltki6l760gv4h&st=k6a8yvh2&dl=1"}
    ];

    /* --- STATE --- */
    let state = {
        money: 0,
        hp: CONFIG.PLAYER_MAX_HP,
        maxHp: CONFIG.PLAYER_MAX_HP,
        wave: 1,
        enemiesLeft: 10,
        isBattle: false,
        activeEnemies: [],
        damage: CONFIG.BASE_DMG,
        isGod: false,
        isAuto: false,
        isSorcerer: false,
        bossActive: false,
        purpTimer: 100,
        adminHold: null,
        heliOwned: false
    };

    /* --- CORE LOGIC --- */
    function syncUI() {
        document.getElementById('m-count').innerText = Math.floor(state.money);
        document.getElementById('player-hp-text').innerText = "–í–∞—à–∞ –®–∫–∞–ª–∞ –•–ü: " + Math.max(0, Math.ceil(state.hp));
        document.getElementById('player-hp-fill').style.width = (state.hp / state.maxHp) * 100 + "%";
        document.getElementById('wave-num').innerText = state.wave + " –í–æ–ª–Ω–∞";
        document.getElementById('enemies-left').innerText = "–û—Å—Ç–∞–ª–æ—Å—å –í—Ä–∞–≥–æ–≤: " + state.enemiesLeft;
    }

    function initiateWave() {
        if (state.isBattle) return;
        
        if (state.wave === 71) {
            spawnFinalBoss();
            return;
        }

        state.isBattle = true;
        state.enemiesLeft = 10;
        document.getElementById('main-ui').style.opacity = "0";
        document.getElementById('main-ui').style.pointerEvents = "none";
        
        if (state.wave <= 3) document.getElementById('hint-text').style.display = "block";

        let spawnedCount = 0;
        let spawnLoop = setInterval(() => {
            if (!state.isBattle || spawnedCount >= 10) {
                clearInterval(spawnLoop);
                return;
            }
            createEnemyUnit();
            spawnedCount++;
        }, 2000);
    }

    function createEnemyUnit() {
        let type = ENEMY_TYPES.find(e => state.wave >= e.waves[0] && state.wave < e.waves[1]);
        if (!type) return;

        let container = document.createElement('div');
        container.className = 'enemy-unit';
        container.innerHTML = `
            <div class="enemy-info">${type.name}</div>
            <div class="enemy-hp-wrap"><div class="enemy-hp-bar"></div></div>
            <img src="${type.img}" style="width:100%">
        `;
        document.getElementById('game-view').appendChild(container);

        let unitObj = {
            dom: container,
            hp: type.hp,
            maxHp: type.hp,
            dmg: type.dmg,
            time: type.time,
            type: type,
            posX: -500,
            dead: false
        };

        if (type.boss) activateBossMode(unitObj);
        
        state.activeEnemies.push(unitObj);
        animateEnemy(unitObj);
    }

    function animateEnemy(unit) {
        let startTime = null;
        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            let progress = (timestamp - startTime) / (unit.time * 1000);
            
            if (unit.dead || !state.isBattle && !unit.type.boss) return;

            // –î–≤–∏–∂–µ–Ω–∏–µ
            let screenW = window.innerWidth;
            unit.posX = -500 + (progress * (screenW + 100));
            unit.dom.style.right = unit.posX + "px";

            // –≠—Ñ—Ñ–µ–∫—Ç –ê–≥–∞—Ç—ã
            if (unit.type.name.includes("Agetha")) {
                let rect = unit.dom.getBoundingClientRect();
                let dist = rect.left;
                let blurVal = Math.max(0, 15 - (dist/80));
                document.getElementById('overlay-fx').style.backdropFilter = `blur(${blurVal}px)`;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Å–∞–Ω–∏—è (–£–†–û–ù –¢–û–õ–¨–ö–û –¢–£–¢)
            let rect = unit.dom.getBoundingClientRect();
            if (rect.left < 450) {
                if (!state.isGod) state.hp -= unit.dmg / 60; // –ü–ª–∞–≤–Ω—ã–π —É—Ä–æ–Ω –ø—Ä–∏ –∫–æ–Ω—Ç–∞–∫—Ç–µ
                syncUI();
                if (state.hp <= 0) endGame();
            }

            if (progress < 1.2) requestAnimationFrame(step);
            else {
                if (!unit.dead) {
                    unit.dom.remove();
                    state.activeEnemies = state.activeEnemies.filter(e => e !== unit);
                    state.enemiesLeft--;
                    checkWaveProgress();
                }
            }
        }
        requestAnimationFrame(step);
    }

    function handleGlobalClick(e) {
        if (!state.isBattle && !state.bossActive) return;
        spawnProjectile("hero", 380, "40%");
    }

    function spawnProjectile(origin, startX, startY) {
        let b = document.createElement('img');
        b.src = "https://www.dropbox.com/scl/fi/p4svu0wsgfhj6gzbb9xvw/Picsart_26-02-25_16-30-12-240.png?rlkey=kjroe5og6sduz1vov53mba0zz&st=b0l23gb9&dl=1";
        b.className = 'bullet';
        b.style.left = startX + "px";
        b.style.bottom = startY;
        document.getElementById('game-view').appendChild(b);

        let curX = startX;
        let bLoop = setInterval(() => {
            curX += 35;
            b.style.left = curX + "px";

            state.activeEnemies.forEach(en => {
                let eRect = en.dom.getBoundingClientRect();
                let bRect = b.getBoundingClientRect();
                if (bRect.right > eRect.left && bRect.left < eRect.right && bRect.top < eRect.bottom && bRect.bottom > eRect.top) {
                    en.hp -= state.damage;
                    updateEnemyVisuals(en);
                    clearInterval(bLoop);
                    b.remove();
                }
            });

            if (curX > window.innerWidth) { clearInterval(bLoop); b.remove(); }
        }, 16);
    }

    function updateEnemyVisuals(en) {
        let bar = en.dom.querySelector('.enemy-hp-bar');
        bar.style.width = (en.hp / en.maxHp) * 100 + "%";
        
        if (state.bossActive) {
            document.getElementById('boss-bar-fill').style.width = (en.hp / en.maxHp) * 100 + "%";
            document.getElementById('boss-bar-text').innerText = Math.floor(en.hp) + " / " + en.maxHp;
        }

        if (en.hp <= 0 && !en.dead) {
            en.dead = true;
            if (en.type.boss) handleBossDefeat(en);
            else {
                en.dom.remove();
                state.activeEnemies = state.activeEnemies.filter(e => e !== en);
                state.money += 120;
                state.enemiesLeft--;
                syncUI();
                checkWaveProgress();
            }
        }
    }

    function checkWaveProgress() {
        if (state.enemiesLeft <= 0 && state.activeEnemies.length === 0) {
            state.isBattle = false;
            state.wave++;
            document.getElementById('main-ui').style.opacity = "1";
            document.getElementById('main-ui').style.pointerEvents = "auto";
            document.getElementById('hint-text').style.display = "none";
            document.getElementById('overlay-fx').style.backdropFilter = "none";
            document.getElementById('overlay-fx').style.background = "transparent";
            syncUI();
        }
    }

    /* --- BOSS LOGIC --- */
    function activateBossMode(en) {
        state.bossActive = true;
        let gui = document.getElementById('global-boss-ui');
        gui.style.display = "flex";
        setTimeout(() => gui.style.opacity = "1", 100);
        document.getElementById('boss-label').innerText = en.type.name + " [BOSS]";
        
        if (en.type.name.includes("Nameless")) {
            setTimeout(() => document.getElementById('overlay-fx').style.background = "rgba(255,0,0,0.3)", 100);
        }
    }

    function handleBossDefeat(en) {
        if (en.type.final) {
            triggerFinalSequence(en);
            return;
        }
        state.bossActive = false;
        en.dom.remove();
        state.activeEnemies = [];
        let gui = document.getElementById('global-boss-ui');
        gui.style.opacity = "0";
        setTimeout(() => gui.style.display = "none", 800);
        state.enemiesLeft = 0;
        checkWaveProgress();
    }

    /* --- FINAL BOSS: PURPULEZKA --- */
    function spawnFinalBoss() {
        state.isBattle = true;
        state.bossActive = true;
        document.getElementById('main-ui').style.opacity = "0";
        
        let type = ENEMY_TYPES.find(e => e.final);
        let container = document.createElement('div');
        container.className = 'enemy-unit';
        container.style.right = "120px";
        container.style.top = "150px";
        container.style.bottom = "auto";
        container.style.animation = "floatBoss 4s infinite ease-in-out";
        container.innerHTML = `<img src="${type.img}" style="width:480px">`;
        document.getElementById('game-view').appendChild(container);

        let purpObj = { dom: container, hp: type.hp, maxHp: type.hp, type: type, dead: false };
        state.activeEnemies.push(purpObj);
        
        activateBossMode(purpObj);
        
        // –ù–∞—á–∞–ª—å–Ω—ã–µ —Å—É–±—Ç–∏—Ç—Ä—ã
        runSubs([
            {a: "–ü—É—Ä–ø—É–ª–µ–∑–∫–∞", t: "–•–ê–•–ê! –°–Æ–†–ü–†–ò–ó! –î–£–ú–ê–õ, –ß–¢–û –£–ù–ò–ß–¢–û–ñ–ò–¢–¨ –ú–û–ò–• –ó–ê–ô–¶–ï–í –ë–´–õ–û –õ–£–ß–®–û–ï –†–ï–®–ï–ù–ò–ï?", d: 4000},
            {a: "–ü—É—Ä–ø—É–ª–µ–∑–∫–∞", t: "–•–ê–•! –ò–î–ò–û–¢! –ù–ê–û–ë–û–†–û–¢ –•–£–ñ–ï! –ù–û –†–ê–ó –ú–´ –í–°–¢–†–ï–¢–ò–õ–ò–°–¨, –î–£–ú–ê–Æ, –ú–ù–ï –°–¢–û–ò–¢ –ß–ï–†–ï–ó 100 –°–ï–ö–£–ù–î –†–ê–ó–í–ê–õ–ò–¢–¨ –¢–í–û–Æ –ö–ê–ë–ò–ù–£! –£ –¢–ï–ë–Ø –†–û–í–ù–û 100 –°–ï–ö–£–ù–î,  –ü–û–ö–ê –ú–û–ò –ù–ï–†–í–´ –ï–©–Å –ù–ï –û–¢–û–®–õ–ò, –ú–û–ñ–ï–®–¨ –°–î–ï–õ–ê–¢–¨ –ü–û–°–õ–ï–î–ù–ò–ï –í–î–û–•–ò!", d: 4000}
        ]);

        // –¶–∏–∫–ª –∫–ª–æ–Ω–æ–≤
        let cloneTimer = setInterval(() => {
            if (!state.bossActive) { clearInterval(cloneTimer); return; }
            firePurpClone();
        }, 10000);

        // –¢–∞–π–º–µ—Ä —Å–º–µ—Ä—Ç–∏
        let deathCountdown = setInterval(() => {
            if (!state.bossActive) { clearInterval(deathCountdown); return; }
            state.purpTimer--;
            if (state.purpTimer <= 0) {
                clearInterval(deathCountdown);
                executePlayer();
            }
        }, 1000);
    }

    function firePurpClone() {
        let c = document.createElement('img');
        c.src = "https://www.dropbox.com/scl/fi/948wqdc7vn67eimy9itur/Picsart_26-02-25_18-08-27-446.png?rlkey=du6vdlmfisfoltki6l760gv4h&st=k6a8yvh2&dl=1";
        c.className = 'clone-projectile';
        c.style.right = "250px"; c.style.top = "250px";
        document.body.appendChild(c);
        
        setTimeout(() => {
            c.style.right = "80%"; c.style.top = "50%";
            setTimeout(() => {
                if (!state.isGod) state.hp -= 10;
                syncUI();
                c.remove();
            }, 800);
        }, 50);
    }

    function executePlayer() {
        runSubs([{a: "–ü—É—Ä–ø—É–ª–µ–∑–∫–∞", t: "–û–ô, –ö–ê–ñ–ï–¢–°–Ø –ö–¢–û-–¢–û –ü–†–û–ò–ì–†–ê–õ, –ü–û–†–ê –ë–´ –†–ê–ó–í–ê–õ–ò–¢–¨ –¢–í–û–Æ –ö–ê–ë–ò–ù–£!", d: 3000}]);
        setTimeout(() => {
            let p = state.activeEnemies[0].dom;
            p.style.transition = "all 0.4s";
            p.style.right = "85%";
            setTimeout(() => { state.hp = 0; syncUI(); endGame(); }, 400);
        }, 3500);
    }

    function triggerFinalSequence(en) {
        state.bossActive = false;
        let p = en.dom;
        p.style.animation = "none";
        p.style.transition = "top 1.5s cubic-bezier(0.47, 0, 0.745, 0.715)";
        p.style.top = "60%"; // –ü–∞–¥–∞–µ—Ç
        
        document.getElementById('global-boss-ui').style.opacity = "0";

        setTimeout(() => {
            p.style.animation = "shakeObject 0.1s infinite";
            runSubs([
                {a: "–ü—É—Ä–ø—É–ª–µ–∑–∫–∞", t: "–¢–´ –°–ß–ò–¢–ï–†–ò–õ! –ò –Ø –ü–†–ï–ö–†–ê–°–ù–û –ú–û–ì–£ –£–í–ò–î–ï–¢–¨ –ü–û –¢–í–û–ï–ú–£ –•–õ–ï–ë–ê–õ–¨–ù–ò–ö–£!", d: 4000},
                {a: "–ü—É—Ä–ø—É–ª–µ–∑–∫–∞", t: "–í –°–õ–ï–î–£–Æ–©–ò–ô –†–ê–ó, –ö–û–ì–î–ê –ë–£–î–ï–®–¨ –°–ü–†–ê–®–ò–í–ê–¢–¨ –£ –°–í–û–ï–ô –ú–ê–ú–´ –ö–¢–û –ë–û–ì, –¢–û –°–ö–ê–ñ–ò –ï–ô –ú–û–Å –ò–ú–Ø–Ø–Ø–Ø!", d: 4000}
            ]);

            setTimeout(() => {
                p.style.transform = "scale(2)";
                let flash = document.getElementById('flash-bang');
                flash.style.display = "block";
                setTimeout(() => flash.style.opacity = "1", 100);
                setTimeout(showEndingCredits, 2000);
            }, 8500);
        }, 1600);
    }

    /* --- HELPERS --- */
    function runSubs(list) {
        let box = document.getElementById('sub-container');
        let txt = document.getElementById('sub-content');
        let aut = document.getElementById('sub-author');
        
        let i = 0;
        function next() {
            if (i < list.length) {
                aut.innerText = list[i].a;
                txt.innerText = list[i].t;
                box.classList.add('visible');
                setTimeout(() => {
                    box.classList.remove('visible');
                    i++;
                    setTimeout(next, 600);
                }, list[i].d);
            }
        }
        next();
    }

    function adminHoldStart() { state.adminHold = setTimeout(() => { document.getElementById('admin-panel').style.display='block'; }, 4000); }
    function adminHoldEnd() { clearTimeout(state.adminHold); }

    function adminAddCash() { state.money += 100000; syncUI(); showFloatText("+100K", "#ff0"); }
    function adminToggleGod() { 
        state.isGod = !state.isGod; 
        if(state.isGod) { state.hp = 999999999; state.maxHp = 999999999; showFloatText("–ü—Ä–æ–∫–ª—è—Ç–∏–µ –í–Ω–µ—Å–µ–Ω–æ.", "red"); }
        else { state.hp = 350; state.maxHp = 350; showFloatText("–í—ã –û—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã", "green"); }
        syncUI();
    }
    function adminToggleAuto() {
        state.isAuto = !state.isAuto;
        if(state.isAuto) setInterval(() => { if(state.isBattle || state.bossActive) handleGlobalClick(); }, 10);
    }
    
    function showFloatText(t, c) {
        let el = document.createElement('div');
        el.style = `position:fixed; left:50%; top:50%; color:${c}; font-size:40px; z-index:20000; transition: all 1s; font-weight:900;`;
        el.innerText = t;
        document.body.appendChild(el);
        setTimeout(() => { el.style.transform = "translateY(-150px)"; el.style.opacity = "0"; }, 50);
        setTimeout(() => el.remove(), 1100);
    }

    function endGame() {
        state.isBattle = false;
        state.bossActive = false;
        document.getElementById('death-screen').style.display = "flex";
    }

    function restartLevel() {
        state.hp = state.maxHp;
        syncUI();
        document.getElementById('death-screen').style.display = "none";
        state.activeEnemies.forEach(e => e.dom.remove());
        state.activeEnemies = [];
        document.getElementById('main-ui').style.opacity = "1";
        document.getElementById('main-ui').style.pointerEvents = "auto";
    }

    function showEndingCredits() {
        let scr = document.getElementById('ending-screen');
        scr.style.display = "flex";
        const lines = ["–≠–π...", "–ù–µ —É—Ö–æ–¥–∏...", "–û!", "–Ø –¥—É–º–∞–ª, —á—Ç–æ –ø–æ—Ç–µ—Ä—è–ª —Ç–µ–±—è...", "–°–ª—É—à–∞–π...", "–Ø —Ö–æ—á—É —Ç–µ–±—è –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å...", "–û–Ω–∏ —É–∂–µ –∑–¥–µ—Å—å, –∏ –∏–¥—É—Ç –∑–∞ —Ç–æ–±–æ–π...", "–¢–µ–±–µ –Ω–∞–¥–æ —Å–∫–∞—Ç—ã–≤–∞—Ç—å—Å—è..."];
        
        let i = 0;
        function step() {
            if (i < lines.length) {
                scr.innerHTML = `<h1 style="color:#000; font-size:40px; transition: opacity 1s; opacity:0" id="end-txt">${lines[i]}</h1>`;
                setTimeout(() => document.getElementById('end-txt').style.opacity = "1", 100);
                setTimeout(() => {
                    document.getElementById('end-txt').style.opacity = "0";
                    i++;
                    setTimeout(step, 1000);
                }, 3000);
            } else {
                scr.innerHTML = `
                    <h1 style="font-size:80px; margin:0">THE END</h1>
                    <p style="font-size:20px">–°–ø–∞—Å–∏–±–æ –ó–∞ –ò–≥—Ä—É! –ò–≥—Ä–∞ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: @Xn1ckname.</p>
                    <h2 style="color:#0f0; text-shadow: 0 0 15px #0f0; font-size:50px">–•–æ—Ä–æ—à–∞—è –ö–æ–Ω—Ü–æ–≤–∫–∞.</h2>
                `;
                setTimeout(() => { scr.style.background = "black"; scr.innerHTML = ""; }, 19000);
                setTimeout(() => location.reload(), 22000);
            }
        }
        step();
    }

    syncUI();
</script>
</body>
</html>

