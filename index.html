<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Purple Battleground - SORCERER UPDATE</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #3d4147; 
            font-family: 'Arial Black', sans-serif; user-select: none; 
            touch-action: manipulation;
        }

        #game-container { position: relative; width: 100vw; height: 100vh; cursor: crosshair; }
        #floor { position: absolute; bottom: 0; width: 100%; height: 40%; background: #60646b; border-top: 12px solid #000; z-index: 10; }

        /* –í–ï–†–•–ù–Ø–Ø –ò–ù–§–û */
        .header-center { position: absolute; top: 15px; left: 5%; width: 90%; display: flex; flex-direction: column; align-items: center; z-index: 100; }
        #title-box { background: #fff; border: 8px solid #000; border-radius: 20px; font-size: 35px; width: 100%; text-align: center; margin-bottom: 5px; }
        #hp-container { background: red; border: 6px solid #000; border-radius: 15px; padding: 10px 0; width: 85%; text-align: center; overflow: hidden; position: relative; }
        #hp-fill { position: absolute; top:0; left:0; width: 100%; height: 100%; background: #ccff00; z-index: 1; transition: width 0.2s; }
        #hp-text { color: #fff; font-size: 24px; text-shadow: 2px 2px 0 #000; position: relative; z-index: 2; }

        /* –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ */
        .left-ui-panel { position: absolute; top: 140px; left: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 100; }
        #money-display { color: #fff; font-size: 35px; text-shadow: 3px 3px 0 #000; }
        #shop-btn { width: 140px; height: 140px; background: #fff; border: 8px solid #000; border-radius: 25px; font-size: 80px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 8px 8px 0 #000; transition: 0.2s; }
        
        .wave-ui { position: absolute; top: 180px; right: 30px; text-align: right; color: #fff; z-index: 100; }
        #wave-big { font-size: 60px; margin: 0; -webkit-text-stroke: 2px #000; }

        /* –ì–ï–†–û–ò */
        #main-hare { position: absolute; bottom: 25%; left: -50px; width: 500px; z-index: 50; transition: transform 0.5s, bottom 0.5s; }
        #heli-hare { position: absolute; bottom: 12%; left: 160px; width: 280px; z-index: 60; display: none; }
        #magic-ball { position: absolute; width: 150px; z-index: 55; display: none; pointer-events: none; }
        #smoke-aura { position: absolute; width: 400px; z-index: 49; display: none; pointer-events: none; opacity: 0.7; }

        /* –í–†–ê–ì–ò */
        .zombie-container { position: absolute; bottom: 25%; right: -350px; width: 320px; z-index: 45; display: flex; flex-direction: column; align-items: center; }
        .zombie-img { width: 100%; }
        .zombie-hp-bar { width: 90%; height: 20px; background: red; border: 3px solid #000; position: relative; }
        .zombie-hp-fill { height: 100%; background: #00ff00; width: 100%; }

        /* –°–ü–û–°–û–ë–ù–û–°–¢–ò */
        #abilities-panel { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%) translateY(200px); display: flex; gap: 20px; z-index: 100; transition: 0.5s ease-out; }
        .ability-btn { width: 150px; height: 100px; background: rgba(0,0,0,0.6); border: 4px solid #fff; color: #fff; display: flex; align-items: center; justify-content: center; text-align: center; cursor: pointer; position: relative; overflow: hidden; font-size: 16px; }
        .cooldown-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 0%; background: rgba(255,0,0,0.6); z-index: 2; transition: height 0s; }

        /* –ê–î–ú–ò–ù–ö–ê */
        #admin-trigger { position: absolute; top: 20px; left: 80%; width: 100px; height: 100px; background: #222; border: 4px solid #fff; color: #fff; display: none; justify-content: center; align-items: center; cursor: move; z-index: 1000; font-size: 12px; }
        #admin-menu { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; height: 550px; background: rgba(0,0,0,0.95); border: 6px solid #fff; display: none; flex-direction: column; padding: 20px; z-index: 1001; color: #fff; }
        .admin-opt { width: 100%; padding: 15px; border: 2px solid #00ff00; margin: 10px 0; background: none; color: #fff; cursor: pointer; }

        /* –û–ö–ù–ê –û–®–ò–ë–û–ö */
        #error-popup { position: fixed; right: -500px; top: 30%; width: 300px; background: #000; border: 3px solid #fff; padding: 20px; color: #fff; z-index: 2000; transition: 0.5s; }
        .reset-btn { background: #fff; color: #000; border: none; padding: 10px 20px; margin-top: 15px; cursor: pointer; font-weight: 900; }

        /* –≠–§–§–ï–ö–¢–´ */
        #red-screen { position: fixed; inset: 0; background: rgba(255,0,0,0.3); display: none; z-index: 99; pointer-events: none; }
        .floating-text { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 45px; font-weight: 900; z-index: 3000; display: none; }
        
        .bullet { position: absolute; z-index: 48; width: 100px; pointer-events: none; }
        #start-btn-ui { position: absolute; bottom: 220px; right: 50px; background: #ccff00; color: #fff; padding: 30px 60px; border: 6px solid #fff; border-radius: 35px; font-size: 40px; z-index: 100; cursor: pointer; }
    </style>
</head>
<body onclick="handleShoot(event)">

<div id="game-container">
    <div id="red-screen"></div>
    <div id="float-msg" class="floating-text"></div>

    <div id="error-popup">
        <p id="error-text">–û—à–∏–±–∫–∞: –•–æ—Ç–∏—Ç–µ –ª–∏ –í—ã –ø–æ–º–µ–Ω—è—Ç—å —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞?</p>
        <button class="reset-btn" id="confirm-btn">–†–µ—Å–µ—Ç</button>
    </div>

    <div class="header-center">
        <div id="title-box">Purple Battleground</div>
        <div id="hp-container"><div id="hp-fill"></div><span id="hp-text">–•–ü: 350</span></div>
    </div>

    <div class="left-ui-panel">
        <div id="money-display">ü™ô: <span id="m-val">0</span></div>
        <div id="shop-btn" onmousedown="startAdminTimer()" onmouseup="stopAdminTimer()" onclick="openShop()">üõçÔ∏è</div>
    </div>

    <div class="wave-ui"><h1 id="wave-big">1 –í–æ–ª–Ω–∞</h1></div>

    <img id="main-hare" src="https://www.dropbox.com/scl/fi/wkk444qzu4xrvq19yhppg/Picsart_26-02-25_16-18-04-032.png?rlkey=7ktujsblwl5rncjhtzwidmw1u&st=w2isyslh&dl=1">
    <img id="heli-hare" src="https://www.dropbox.com/scl/fi/12vlohfl9xc1gsyc834ud/Picsart_26-02-25_20-07-48-108.png?rlkey=ufof2v3c18mp9s0ym3tqlm1sg&st=pyzps94y&dl=1">
    <img id="magic-ball" src="">
    <img id="smoke-aura" src="https://www.dropbox.com/scl/fi/csmhqsa106rxm5r1orwim/Picsart_26-02-25_22-11-03-878.png?rlkey=0v80wn75bqska23tp4b7l8yfp&st=fwso0zdm&dl=1">

    <div id="floor"></div>
    <div id="start-btn-ui" onclick="startBattle()">–ù–∞—á–∞—Ç—å –ü–µ—Ä–µ—Å—Ç—Ä–µ–ª–∫—É</div>

    <div id="abilities-panel">
        <div class="ability-btn" onclick="useAbility('red')">Red Ball<div class="cooldown-overlay"></div></div>
        <div class="ability-btn" onclick="useAbility('blue')">Infinity Blue Ball<div class="cooldown-overlay"></div></div>
        <div class="ability-btn" onclick="useAbility('smoke')">Infinity<div class="cooldown-overlay"></div></div>
    </div>

    <div id="admin-trigger">–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å 1.3 üó£üî•</div>
    <div id="admin-menu">
        <div onclick="closeAdmin()" style="cursor:pointer; font-size:30px;">X</div>
        <h2>–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å 1.3</h2>
        <button class="admin-opt" onclick="toggleInfMoney()">–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –¥–µ–Ω—å–≥–∏</button>
        <button class="admin-opt" onclick="adminSkipWave()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–æ–ª–Ω—É</button>
        <div id="sorcerer-toggle" class="admin-opt" style="border-color:yellow; display:flex; align-items:center; gap:10px;" onclick="triggerChangePopup()">
            <img id="sorc-icon" src="https://www.dropbox.com/scl/fi/cc4cwmtqchatzfo5uif7z/SorcererIcon.webp?rlkey=irn4n55aqudv4zfs568aacz6q&st=jlxlg0lk&dl=1" width="40">
            <span id="sorc-txt" style="color:yellow">Sorcerer</span>
        </div>
    </div>
</div>

<script>
    let money = 0; let hp = 350; let damage = 50;
    let wave = 1; let enemiesLeft = 10;
    let isGameActive = false; let isSorcerer = false;
    let hasHeli = false; let infMoney = false;
    let adminTimer; let cooldowns = { red: false, blue: false, smoke: false };

    // --- –°–ò–°–¢–ï–ú–ê –ü–ï–†–°–û–ù–ê–ñ–ê ---
    function triggerChangePopup() {
        closeAdmin();
        const popup = document.getElementById('error-popup');
        const txt = document.getElementById('error-text');
        const btn = document.getElementById('confirm-btn');
        
        if (!isSorcerer) {
            txt.innerText = "–û—à–∏–±–∫–∞: –•–æ—Ç–∏—Ç–µ –ª–∏ –í—ã –ø–æ–º–µ–Ω—è—Ç—å —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞?";
            btn.innerText = "–†–µ—Å–µ—Ç";
        } else {
            txt.innerText = "–û—à–∏–±–∫–∞: –í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å —Å–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –æ–±–ª–∏–∫! –•–æ—Ç–∏—Ç–µ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å?";
            btn.innerText = "–î–∞!";
        }
        
        popup.style.right = "20px";
        btn.onclick = () => {
            isSorcerer = !isSorcerer;
            applyCharacterSkin();
            popup.style.right = "-500px";
            showFloatMsg("–í—ã –°–º–µ–Ω–∏–ª–∏ –°–≤–æ–π –û–±–ª–∏–∫", isSorcerer ? "red" : "#a020f0", true);
        };
        
        setTimeout(() => { popup.style.right = "-500px"; }, 5000);
    }

    function applyCharacterSkin() {
        const hare = document.getElementById('main-hare');
        const icon = document.getElementById('sorc-icon');
        const txt = document.getElementById('sorc-txt');
        
        if (isSorcerer) {
            hare.src = "https://www.dropbox.com/scl/fi/y4osxbudupe0wnhweeaf9/Picsart_26-02-25_22-08-16-343.png?rlkey=kb5bal51fdx58x3wji1jakaf5&st=i1x9ioj5&dl=1";
            txt.innerText = "Purple Hare";
            icon.src = "https://www.dropbox.com/scl/fi/wkk444qzu4xrvq19yhppg/Picsart_26-02-25_16-18-04-032.png?rlkey=7ktujsblwl5rncjhtzwidmw1u&st=w2isyslh&dl=1";
        } else {
            hare.src = "https://www.dropbox.com/scl/fi/wkk444qzu4xrvq19yhppg/Picsart_26-02-25_16-18-04-032.png?rlkey=7ktujsblwl5rncjhtzwidmw1u&st=w2isyslh&dl=1";
            txt.innerText = "Sorcerer";
            icon.src = "https://www.dropbox.com/scl/fi/cc4cwmtqchatzfo5uif7z/SorcererIcon.webp?rlkey=irn4n55aqudv4zfs568aacz6q&st=jlxlg0lk&dl=1";
        }
    }

    // --- –°–ü–û–°–û–ë–ù–û–°–¢–ò ---
    function useAbility(type) {
        if (!isGameActive || cooldowns[type]) return;
        
        cooldowns[type] = true;
        startCooldown(type);

        const hare = document.getElementById('main-hare');
        const ball = document.getElementById('magic-ball');

        if (type === 'red') {
            document.getElementById('red-screen').style.display = 'block';
            ball.src = "https://www.dropbox.com/scl/fi/7cnx2g5sp2ggmr62q63ur/Picsart_26-02-25_22-08-44-789.png?rlkey=gnmnldzy0874ffnrcedd8ebhl&st=96ych0my&dl=1";
            ball.style.display = 'block';
            ball.style.left = "250px"; ball.style.bottom = "45%";
            
            setTimeout(() => {
                document.getElementById('red-screen').style.display = 'none';
                let bPos = 250;
                let rot = 0;
                let move = setInterval(() => {
                    bPos += 30; rot += 20;
                    ball.style.left = bPos + 'px';
                    ball.style.transform = `rotate(${rot}deg)`;
                    
                    document.querySelectorAll('.zombie-container').forEach(z => {
                        let zR = z.getBoundingClientRect(), bR = ball.getBoundingClientRect();
                        if (bR.right > zR.left && bR.left < zR.right) {
                            damageEnemy(z, 9999999);
                        }
                    });
                    if (bPos > window.innerWidth) { clearInterval(move); ball.style.display = 'none'; }
                }, 20);
            }, 2000);

        } else if (type === 'blue') {
            hare.style.transform = "translateY(-150px)";
            setTimeout(() => { hare.style.transform = "translateY(0)"; }, 500);
            
            setTimeout(() => {
                ball.src = "https://www.dropbox.com/scl/fi/k7ihgno4veccayv3byksc/Picsart_26-02-25_22-10-29-076.png?rlkey=8nxc67mzs2jy7u23dtyn80qus&st=nh1qobs2&dl=1";
                ball.style.display = 'block';
                ball.style.width = "50px"; ball.style.left = "300px"; ball.style.bottom = "40%";
                
                let size = 50;
                let grow = setInterval(() => {
                    size += 2; ball.style.width = size + "px";
                    if (size >= 250) {
                        clearInterval(grow);
                        let bPos = 300;
                        let fly = setInterval(() => {
                            bPos += 2; ball.style.left = bPos + "px";
                            ball.style.transform = `rotate(${Date.now()/5 % 360}deg)`;
                            document.querySelectorAll('.zombie-container').forEach(z => {
                                let zR = z.getBoundingClientRect(), bR = ball.getBoundingClientRect();
                                if (Math.abs(zR.left - bR.left) < 300) {
                                    z.style.transform = `translateX(${(bR.left - zR.left)/10}px)`;
                                    damageEnemy(z, 50);
                                }
                            });
                        }, 20);
                        setTimeout(() => { clearInterval(fly); ball.style.display = 'none'; }, 15000);
                    }
                }, 50);
            }, 5000);

        } else if (type === 'smoke') {
            const smoke = document.getElementById('smoke-aura');
            smoke.style.display = 'block';
            smoke.style.left = "50px"; smoke.style.bottom = "20%";
            let time = 0;
            let auraInt = setInterval(() => {
                time += 100;
                document.querySelectorAll('.zombie-container').forEach(z => {
                    let zR = z.getBoundingClientRect(), sR = smoke.getBoundingClientRect();
                    if (zR.left < sR.right) {
                        z.dataset.speed = 0.5; // –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ
                        if (zR.left < sR.right - 100) z.dataset.frozen = "true"; // –ó–∞—Å—Ç—ã–ª
                    }
                });
                if (time >= 12000) { clearInterval(auraInt); smoke.style.display = 'none'; }
            }, 100);
        }
    }

    function startCooldown(type) {
        const btns = document.querySelectorAll('.ability-btn');
        let idx = type === 'red' ? 0 : (type === 'blue' ? 1 : 2);
        let overlay = btns[idx].querySelector('.cooldown-overlay');
        overlay.style.height = "100%";
        let h = 100;
        let cd = setInterval(() => {
            h -= 0.5;
            overlay.style.height = h + "%";
            if (h <= 0) { clearInterval(cd); cooldowns[type] = false; }
        }, 100);
    }

    // --- –ë–ê–ó–û–í–ê–Ø –õ–û–ì–ò–ö–ê ---
    function startBattle() {
        if (isGameActive) return;
        isGameActive = true; enemiesLeft = 10;
        document.getElementById('start-btn-ui').style.display = 'none';
        if (isSorcerer) {
            document.getElementById('abilities-panel').style.transform = "translateX(-50%) translateY(0)";
        }
        updateUI(); spawnSequence();
    }

    function enemyDefeated() {
        enemiesLeft--; updateUI();
        if (enemiesLeft <= 0) {
            isGameActive = false; wave++;
            document.getElementById('wave-big').innerText = wave + " –í–æ–ª–Ω–∞";
            document.getElementById('start-btn-ui').style.display = 'block';
            document.getElementById('abilities-panel').style.transform = "translateX(-50%) translateY(200px)";
        }
    }

    function damageEnemy(z, dmg) {
        z.dataset.hp -= dmg;
        z.querySelector('.zombie-hp-fill').style.width = (z.dataset.hp / z.dataset.maxHp) * 100 + "%";
        if (z.dataset.hp <= 0) { clearInterval(z.dataset.moveInt); z.remove(); enemyDefeated(); if(!infMoney) money += 85; updateUI(); }
    }

    function spawnEnemy() {
        if (!isGameActive) return;
        let container = document.createElement('div');
        container.className = 'zombie-container';
        let hpMax = 55 + (wave * 20);
        container.dataset.hp = hpMax; container.dataset.maxHp = hpMax;
        container.dataset.frozen = "false"; container.dataset.speed = 1;
        
        container.innerHTML = `<div class="zombie-hp-bar"><div class="zombie-hp-fill"></div></div><img class="zombie-img" src="https://www.dropbox.com/scl/fi/1lsjdbdu0i9ubx2br0a07/Picsart_26-02-25_19-08-39-629.png?rlkey=7guurshr8yh3dd4e2ljmggjlj&st=j2fo8ed0&dl=1">`;
        document.getElementById('game-container').appendChild(container);

        let pos = -350;
        let moveInt = setInterval(() => {
            if (container.dataset.frozen === "true") return;
            pos += (3 * container.dataset.speed);
            container.style.right = pos + 'px';
            if (window.innerWidth - pos < 400) {
                hp -= 35; updateUI(); container.remove(); clearInterval(moveInt); enemyDefeated();
                if (hp <= 0) { alert("Game Over"); location.reload(); }
            }
        }, 20);
        container.dataset.moveInt = moveInt;
    }

    function spawnSequence() { if(isGameActive && enemiesLeft > 0) { spawnEnemy(); setTimeout(spawnSequence, 3000); } }

    function handleShoot(e) {
        if (!isGameActive || isSorcerer) return; // Sorcerer –Ω–µ —Å—Ç—Ä–µ–ª—è–µ—Ç –æ–±—ã—á–Ω–æ
        let b = document.createElement('img');
        b.src = "https://www.dropbox.com/scl/fi/p4svu0wsgfhj6gzbb9xvw/Picsart_26-02-25_16-30-12-240.png?rlkey=kjroe5og6sduz1vov53mba0zz&st=b0l23gm9&dl=1";
        b.className = 'bullet';
        b.style.left = "350px"; b.style.bottom = "38%";
        document.getElementById('game-container').appendChild(b);
        let bPos = 350;
        let bInt = setInterval(() => {
            bPos += 25; b.style.left = bPos + 'px';
            document.querySelectorAll('.zombie-container').forEach(z => {
                let zR = z.getBoundingClientRect(), bR = b.getBoundingClientRect();
                if (bR.right > zR.left && bR.left < zR.right) {
                    damageEnemy(z, damage); b.remove(); clearInterval(bInt);
                }
            });
            if (bPos > window.innerWidth) { b.remove(); clearInterval(bInt); }
        }, 20);
    }

    // --- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ (DRAG) ---
    const dragEl = document.getElementById("admin-trigger");
    function startAdminTimer() { adminTimer = setTimeout(() => { dragEl.style.display = 'flex'; }, 5000); }
    function stopAdminTimer() { clearTimeout(adminTimer); }
    function closeAdmin() { document.getElementById('admin-menu').style.display = 'none'; }
    
    dragEl.onmousedown = (e) => {
        let shiftX = e.clientX - dragEl.getBoundingClientRect().left;
        let shiftY = e.clientY - dragEl.getBoundingClientRect().top;
        document.onmousemove = (e) => {
            dragEl.style.left = e.clientX - shiftX + 'px';
            dragEl.style.top = e.clientY - shiftY + 'px';
        };
        document.onmouseup = () => { document.onmousemove = null; };
    };
    dragEl.onclick = () => { document.getElementById('admin-menu').style.display = 'flex'; };

    function updateUI() {
        document.getElementById('m-val').innerText = infMoney ? "‚àû" : money;
        document.getElementById('hp-text').innerText = "–•–ü: " + hp;
        document.getElementById('hp-fill').style.width = (hp/350)*100 + "%";
    }

    function showFloatMsg(txt, color, stroke) {
        let el = document.getElementById('float-msg');
        el.innerText = txt; el.style.color = color; el.style.display = 'block';
        el.style.webkitTextStroke = stroke ? "2px white" : "none";
        setTimeout(() => el.style.display = 'none', 2000);
    }
    
    function toggleInfMoney() { infMoney = !infMoney; money = infMoney ? 9999999 : 0; updateUI(); }
    function adminSkipWave() { enemiesLeft = 0; enemyDefeated(); }
</script>
</body>
</html>

